<html>
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
  <title>3D Game Design</title>
  <script src="cannon.js"></script>
  <script src="babylon.js"></script>
  <script src="babylon.objFileLoader.min.js"></script>
  <style>
    html, body {
      overflow: hidden;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #renderCanvas {
      width: 100%;
      height: 100%;
      touch-action: none;
    }

    #timer {
      position: absolute;
      left:10px;
      bottom:10px;
      color:#ccc;
      font: 52px sans-serif;
    }

  </style>
  <script>
    function start() {
      var canvas = document.getElementById('renderCanvas');
      
      var engine = new BABYLON.Engine(canvas, true);
      var keys = {};

      var startTime = 0;
      var timer = document.querySelector('#timer');

      window.addEventListener('keydown', function(e) {
        keys[e.key] = true;
      });
      window.addEventListener('keyup', function(e) {
        keys[e.key] = false;
      });
      var scene = new BABYLON.Scene(engine);
      var gravityVector = new BABYLON.Vector3(0, -9.81, 0);
      scene.enablePhysics(gravityVector, new BABYLON.CannonJSPlugin());
      scene.clearColor = new BABYLON.Color3(10 ,5 ,0);
      
      scene.clearColor = new BABYLON.Color3.Purple();      
      //===TRACK CODE
     var _xFn = function(t) {var fns = [function(t) {return (Math.pow((1-t),3)*0.4875)+(3*t*Math.pow((1-t),2)*0.3625)+(3*Math.pow(t,2)*(1-t)*0.4275)+(Math.pow(t,3)*0.5225)},function(t) {return (Math.pow((1-t),3)*0.5225)+(3*t*Math.pow((1-t),2)*0.6175)+(3*Math.pow(t,2)*(1-t)*0.5225)+(Math.pow(t,3)*0.5225)},function(t) {return (Math.pow((1-t),3)*0.5225)+(3*t*Math.pow((1-t),2)*0.5225)+(3*Math.pow(t,2)*(1-t)*0.46)+(Math.pow(t,3)*0.45)},function(t) {return (Math.pow((1-t),3)*0.45)+(3*t*Math.pow((1-t),2)*0.44)+(3*Math.pow(t,2)*(1-t)*0.3875)+(Math.pow(t,3)*0.3875)},function(t) {return (Math.pow((1-t),3)*0.3875)+(3*t*Math.pow((1-t),2)*0.3875)+(3*Math.pow(t,2)*(1-t)*0.315)+(Math.pow(t,3)*0.315)},function(t) {return (Math.pow((1-t),3)*0.315)+(3*t*Math.pow((1-t),2)*0.315)+(3*Math.pow(t,2)*(1-t)*0.2975)+(Math.pow(t,3)*0.2975)},function(t) {return (Math.pow((1-t),3)*0.2975)+(3*t*Math.pow((1-t),2)*0.2975)+(3*Math.pow(t,2)*(1-t)*0.31)+(Math.pow(t,3)*0.31)},function(t) {return (Math.pow((1-t),3)*0.31)+(3*t*Math.pow((1-t),2)*0.31)+(3*Math.pow(t,2)*(1-t)*0.3425)+(Math.pow(t,3)*0.3425)},function(t) {return (Math.pow((1-t),3)*0.3425)+(3*t*Math.pow((1-t),2)*0.3425)+(3*Math.pow(t,2)*(1-t)*0.37)+(Math.pow(t,3)*0.37)},function(t) {return (Math.pow((1-t),3)*0.37)+(3*t*Math.pow((1-t),2)*0.37)+(3*Math.pow(t,2)*(1-t)*0.3875)+(Math.pow(t,3)*0.3875)},function(t) {return (Math.pow((1-t),3)*0.3875)+(3*t*Math.pow((1-t),2)*0.3875)+(3*Math.pow(t,2)*(1-t)*0.3925)+(Math.pow(t,3)*0.3925)},function(t) {return (Math.pow((1-t),3)*0.3925)+(3*t*Math.pow((1-t),2)*0.3925)+(3*Math.pow(t,2)*(1-t)*0.3675)+(Math.pow(t,3)*0.3675)},function(t) {return (Math.pow((1-t),3)*0.3675)+(3*t*Math.pow((1-t),2)*0.3675)+(3*Math.pow(t,2)*(1-t)*0.3425)+(Math.pow(t,3)*0.3425)},function(t) {return (Math.pow((1-t),3)*0.3425)+(3*t*Math.pow((1-t),2)*0.3425)+(3*Math.pow(t,2)*(1-t)*0.305)+(Math.pow(t,3)*0.305)},function(t) {return (Math.pow((1-t),3)*0.305)+(3*t*Math.pow((1-t),2)*0.305)+(3*Math.pow(t,2)*(1-t)*0.26)+(Math.pow(t,3)*0.26)},function(t) {return (Math.pow((1-t),3)*0.26)+(3*t*Math.pow((1-t),2)*0.26)+(3*Math.pow(t,2)*(1-t)*0.2225)+(Math.pow(t,3)*0.2225)},function(t) {return (Math.pow((1-t),3)*0.2225)+(3*t*Math.pow((1-t),2)*0.2225)+(3*Math.pow(t,2)*(1-t)*0.19)+(Math.pow(t,3)*0.19)},function(t) {return (Math.pow((1-t),3)*0.19)+(3*t*Math.pow((1-t),2)*0.19)+(3*Math.pow(t,2)*(1-t)*0.1525)+(Math.pow(t,3)*0.1525)},function(t) {return (Math.pow((1-t),3)*0.1525)+(3*t*Math.pow((1-t),2)*0.1525)+(3*Math.pow(t,2)*(1-t)*0.13)+(Math.pow(t,3)*0.13)},function(t) {return (Math.pow((1-t),3)*0.13)+(3*t*Math.pow((1-t),2)*0.13)+(3*Math.pow(t,2)*(1-t)*0.13)+(Math.pow(t,3)*0.13)},function(t) {return (Math.pow((1-t),3)*0.13)+(3*t*Math.pow((1-t),2)*0.13)+(3*Math.pow(t,2)*(1-t)*0.145)+(Math.pow(t,3)*0.145)},function(t) {return (Math.pow((1-t),3)*0.145)+(3*t*Math.pow((1-t),2)*0.145)+(3*Math.pow(t,2)*(1-t)*0.1825)+(Math.pow(t,3)*0.1825)},function(t) {return (Math.pow((1-t),3)*0.1825)+(3*t*Math.pow((1-t),2)*0.1825)+(3*Math.pow(t,2)*(1-t)*0.22)+(Math.pow(t,3)*0.22)},function(t) {return (Math.pow((1-t),3)*0.22)+(3*t*Math.pow((1-t),2)*0.22)+(3*Math.pow(t,2)*(1-t)*0.2425)+(Math.pow(t,3)*0.2425)},function(t) {return (Math.pow((1-t),3)*0.2425)+(3*t*Math.pow((1-t),2)*0.2425)+(3*Math.pow(t,2)*(1-t)*0.26)+(Math.pow(t,3)*0.26)},function(t) {return (Math.pow((1-t),3)*0.26)+(3*t*Math.pow((1-t),2)*0.26)+(3*Math.pow(t,2)*(1-t)*0.2625)+(Math.pow(t,3)*0.2625)},function(t) {return (Math.pow((1-t),3)*0.2625)+(3*t*Math.pow((1-t),2)*0.2625)+(3*Math.pow(t,2)*(1-t)*0.2525)+(Math.pow(t,3)*0.2525)},function(t) {return (Math.pow((1-t),3)*0.2525)+(3*t*Math.pow((1-t),2)*0.2525)+(3*Math.pow(t,2)*(1-t)*0.2175)+(Math.pow(t,3)*0.2175)},function(t) {return (Math.pow((1-t),3)*0.2175)+(3*t*Math.pow((1-t),2)*0.2175)+(3*Math.pow(t,2)*(1-t)*0.1875)+(Math.pow(t,3)*0.1875)},function(t) {return (Math.pow((1-t),3)*0.1875)+(3*t*Math.pow((1-t),2)*0.1875)+(3*Math.pow(t,2)*(1-t)*0.1775)+(Math.pow(t,3)*0.1775)},function(t) {return (Math.pow((1-t),3)*0.1775)+(3*t*Math.pow((1-t),2)*0.1775)+(3*Math.pow(t,2)*(1-t)*0.1875)+(Math.pow(t,3)*0.1875)},function(t) {return (Math.pow((1-t),3)*0.1875)+(3*t*Math.pow((1-t),2)*0.1875)+(3*Math.pow(t,2)*(1-t)*0.2175)+(Math.pow(t,3)*0.2175)}];var i = Math.max(0,Math.min(31, Math.floor(t * 32)));return fns[i]((t - (i/32)) * 32);};
var _yFn = function(t) {var fns = [function(t) {return (Math.pow((1-t),3)*0.4528125)+(3*t*Math.pow((1-t),2)*0.3253125)+(3*Math.pow(t,2)*(1-t)*0.3253125)+(Math.pow(t,3)*0.4128125)},function(t) {return (Math.pow((1-t),3)*0.4128125)+(3*t*Math.pow((1-t),2)*0.5003125)+(3*Math.pow(t,2)*(1-t)*0.3303125)+(Math.pow(t,3)*0.3303125)},function(t) {return (Math.pow((1-t),3)*0.3303125)+(3*t*Math.pow((1-t),2)*0.3303125)+(3*Math.pow(t,2)*(1-t)*0.2203125)+(Math.pow(t,3)*0.2378125)},function(t) {return (Math.pow((1-t),3)*0.2378125)+(3*t*Math.pow((1-t),2)*0.2553125)+(3*Math.pow(t,2)*(1-t)*0.2478125)+(Math.pow(t,3)*0.2478125)},function(t) {return (Math.pow((1-t),3)*0.2478125)+(3*t*Math.pow((1-t),2)*0.2478125)+(3*Math.pow(t,2)*(1-t)*0.2978125)+(Math.pow(t,3)*0.2978125)},function(t) {return (Math.pow((1-t),3)*0.2978125)+(3*t*Math.pow((1-t),2)*0.2978125)+(3*Math.pow(t,2)*(1-t)*0.3603125)+(Math.pow(t,3)*0.3603125)},function(t) {return (Math.pow((1-t),3)*0.3603125)+(3*t*Math.pow((1-t),2)*0.3603125)+(3*Math.pow(t,2)*(1-t)*0.4078125)+(Math.pow(t,3)*0.4078125)},function(t) {return (Math.pow((1-t),3)*0.4078125)+(3*t*Math.pow((1-t),2)*0.4078125)+(3*Math.pow(t,2)*(1-t)*0.4803125)+(Math.pow(t,3)*0.4803125)},function(t) {return (Math.pow((1-t),3)*0.4803125)+(3*t*Math.pow((1-t),2)*0.4803125)+(3*Math.pow(t,2)*(1-t)*0.5203125)+(Math.pow(t,3)*0.5203125)},function(t) {return (Math.pow((1-t),3)*0.5203125)+(3*t*Math.pow((1-t),2)*0.5203125)+(3*Math.pow(t,2)*(1-t)*0.5578125)+(Math.pow(t,3)*0.5578125)},function(t) {return (Math.pow((1-t),3)*0.5578125)+(3*t*Math.pow((1-t),2)*0.5578125)+(3*Math.pow(t,2)*(1-t)*0.6303125)+(Math.pow(t,3)*0.6303125)},function(t) {return (Math.pow((1-t),3)*0.6303125)+(3*t*Math.pow((1-t),2)*0.6303125)+(3*Math.pow(t,2)*(1-t)*0.6803125)+(Math.pow(t,3)*0.6803125)},function(t) {return (Math.pow((1-t),3)*0.6803125)+(3*t*Math.pow((1-t),2)*0.6803125)+(3*Math.pow(t,2)*(1-t)*0.7028125)+(Math.pow(t,3)*0.7028125)},function(t) {return (Math.pow((1-t),3)*0.7028125)+(3*t*Math.pow((1-t),2)*0.7028125)+(3*Math.pow(t,2)*(1-t)*0.7203125)+(Math.pow(t,3)*0.7203125)},function(t) {return (Math.pow((1-t),3)*0.7203125)+(3*t*Math.pow((1-t),2)*0.7203125)+(3*Math.pow(t,2)*(1-t)*0.7203125)+(Math.pow(t,3)*0.7203125)},function(t) {return (Math.pow((1-t),3)*0.7203125)+(3*t*Math.pow((1-t),2)*0.7203125)+(3*Math.pow(t,2)*(1-t)*0.7228125)+(Math.pow(t,3)*0.7228125)},function(t) {return (Math.pow((1-t),3)*0.7228125)+(3*t*Math.pow((1-t),2)*0.7228125)+(3*Math.pow(t,2)*(1-t)*0.7228125)+(Math.pow(t,3)*0.7228125)},function(t) {return (Math.pow((1-t),3)*0.7228125)+(3*t*Math.pow((1-t),2)*0.7228125)+(3*Math.pow(t,2)*(1-t)*0.6953125)+(Math.pow(t,3)*0.6953125)},function(t) {return (Math.pow((1-t),3)*0.6953125)+(3*t*Math.pow((1-t),2)*0.6953125)+(3*Math.pow(t,2)*(1-t)*0.6428125)+(Math.pow(t,3)*0.6428125)},function(t) {return (Math.pow((1-t),3)*0.6428125)+(3*t*Math.pow((1-t),2)*0.6428125)+(3*Math.pow(t,2)*(1-t)*0.6103125)+(Math.pow(t,3)*0.6103125)},function(t) {return (Math.pow((1-t),3)*0.6103125)+(3*t*Math.pow((1-t),2)*0.6103125)+(3*Math.pow(t,2)*(1-t)*0.5728125)+(Math.pow(t,3)*0.5728125)},function(t) {return (Math.pow((1-t),3)*0.5728125)+(3*t*Math.pow((1-t),2)*0.5728125)+(3*Math.pow(t,2)*(1-t)*0.5728125)+(Math.pow(t,3)*0.5728125)},function(t) {return (Math.pow((1-t),3)*0.5728125)+(3*t*Math.pow((1-t),2)*0.5728125)+(3*Math.pow(t,2)*(1-t)*0.5853125)+(Math.pow(t,3)*0.5853125)},function(t) {return (Math.pow((1-t),3)*0.5853125)+(3*t*Math.pow((1-t),2)*0.5853125)+(3*Math.pow(t,2)*(1-t)*0.5903125)+(Math.pow(t,3)*0.5903125)},function(t) {return (Math.pow((1-t),3)*0.5903125)+(3*t*Math.pow((1-t),2)*0.5903125)+(3*Math.pow(t,2)*(1-t)*0.6028125)+(Math.pow(t,3)*0.6028125)},function(t) {return (Math.pow((1-t),3)*0.6028125)+(3*t*Math.pow((1-t),2)*0.6028125)+(3*Math.pow(t,2)*(1-t)*0.6278125)+(Math.pow(t,3)*0.6278125)},function(t) {return (Math.pow((1-t),3)*0.6278125)+(3*t*Math.pow((1-t),2)*0.6278125)+(3*Math.pow(t,2)*(1-t)*0.6603125)+(Math.pow(t,3)*0.6603125)},function(t) {return (Math.pow((1-t),3)*0.6603125)+(3*t*Math.pow((1-t),2)*0.6603125)+(3*Math.pow(t,2)*(1-t)*0.6728125)+(Math.pow(t,3)*0.6728125)},function(t) {return (Math.pow((1-t),3)*0.6728125)+(3*t*Math.pow((1-t),2)*0.6728125)+(3*Math.pow(t,2)*(1-t)*0.6628125)+(Math.pow(t,3)*0.6628125)},function(t) {return (Math.pow((1-t),3)*0.6628125)+(3*t*Math.pow((1-t),2)*0.6628125)+(3*Math.pow(t,2)*(1-t)*0.6428125)+(Math.pow(t,3)*0.6428125)},function(t) {return (Math.pow((1-t),3)*0.6428125)+(3*t*Math.pow((1-t),2)*0.6428125)+(3*Math.pow(t,2)*(1-t)*0.6203125)+(Math.pow(t,3)*0.6203125)},function(t) {return (Math.pow((1-t),3)*0.6203125)+(3*t*Math.pow((1-t),2)*0.6203125)+(3*Math.pow(t,2)*(1-t)*0.6278125)+(Math.pow(t,3)*0.6278125)}];var i = Math.max(0,Math.min(31, Math.floor(t * 32)));return fns[i]((t - (i/32)) * 32);};
/* START CURVE DATA 
{"start":[195,181.125],"init":[145,130.125],"segments":[{"a":[171,130.125],"b":[209,165.125]},{"a":[209,132.125],"b":[209,132.125]},{"a":[184,88.125],"b":[180,95.125]},{"a":[155,99.125],"b":[155,99.125]},{"a":[126,119.125],"b":[126,119.125]},{"a":[119,144.125],"b":[119,144.125]},{"a":[124,163.125],"b":[124,163.125]},{"a":[137,192.125],"b":[137,192.125]},{"a":[148,208.125],"b":[148,208.125]},{"a":[155,223.125],"b":[155,223.125]},{"a":[157,252.125],"b":[157,252.125]},{"a":[147,272.125],"b":[147,272.125]},{"a":[137,281.125],"b":[137,281.125]},{"a":[122,288.125],"b":[122,288.125]},{"a":[104,288.125],"b":[104,288.125]},{"a":[89,289.125],"b":[89,289.125]},{"a":[76,289.125],"b":[76,289.125]},{"a":[61,278.125],"b":[61,278.125]},{"a":[52,257.125],"b":[52,257.125]},{"a":[52,244.125],"b":[52,244.125]},{"a":[58,229.125],"b":[58,229.125]},{"a":[73,229.125],"b":[73,229.125]},{"a":[88,234.125],"b":[88,234.125]},{"a":[97,236.125],"b":[97,236.125]},{"a":[104,241.125],"b":[104,241.125]},{"a":[105,251.125],"b":[105,251.125]},{"a":[101,264.125],"b":[101,264.125]},{"a":[87,269.125],"b":[87,269.125]},{"a":[75,265.125],"b":[75,265.125]},{"a":[71,257.125],"b":[71,257.125]},{"a":[75,248.125],"b":[75,248.125]},{"a":[87,251.125],"b":[87,251.125]}]}
   END CURVE DATA */
			//===END TRACK CODE
      var xFn = function(t) { return 650 * _xFn(t); }
      var zFn = function(t) { return 650 * _yFn(t); }
      var playerSphere = BABYLON.MeshBuilder.CreateSphere("playerSphere", {
        segments: 12,
        diameter: 4
      }, scene);
        playerSphere.material = new BABYLON.StandardMaterial("playerSphereMaterial", scene);
       playerSphere.material.diffuseTexture = new BABYLON.Texture('resources/BeachBallColor.jpg', scene);
       playerSphere.position = new BABYLON.Vector3(xFn(0), 9, zFn(0));
      playerSphere.physicsImpostor = new BABYLON.PhysicsImpostor(playerSphere, BABYLON.PhysicsImpostor.SphereImpostor, {
        mass: 1,
        restitution: 0.9
      }, scene);

     BABYLON.SceneLoader.ImportMesh(null, "resources/", "speed.obj", scene, function(meshes) {
      var boostMesh = meshes[0], boosts = [];
      boostMesh.material = new BABYLON.StandardMaterial("boostMaterial", scene);
      boostMesh.material.diffuseColor = new BABYLON.Color3(1, 1, 0);
      boostMesh.scaling = new BABYLON.Vector3(5, 5, 5);
      boostMesh.setEnabled(false);
      function boostAt(xFn, zFn, t) {
      var newBoost = boostMesh.clone('boost');
      newBoost.position = new BABYLON.Vector3(xFn(t), 3.2, zFn(t));
      newBoost.rotation.y = -derivAngle(t, xFn, zFn);
      newBoost.setEnabled(true);
      boosts.push(newBoost);
}

      // Place boosts here
      boostAt(xFn, zFn, 0.05);

      scene.registerAfterRender(function() {
      //Lots of code in this function


      boosts.forEach(function(boost, i){
      if(boost.intersectsMesh(playerSphere)){
      boost.dispose();
      boosts.splice(i,1);
      var vel = playerSphere.physicsImpostor.getLinearVelocity();
      playerSphere.applyImpulse(vel.normalize().scale(100), playerSphere.getAbsolutePosition());
      } else {
      boost.rotation.y += 0.01
      }
      });
      });
      });  
 		var camera = new BABYLON.ArcRotateCamera("Camera", 0, (3 * Math.PI) / 8, 20, playerSphere, scene);
       	camera.attachControl(canvas, true);
       	var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0, 1, 0), scene);
       rampAt(xFn, zFn, 0.07, -Math.PI / 4, scene); 
        rampAt(xFn, zFn, 0.11, -Math.PI / 4, scene);
        rampAt(xFn, zFn, 0.29, -Math.PI / 4, scene);
       	scene.registerAfterRender(function() {
          var vel = playerSphere.physicsImpostor.getLinearVelocity();
          playerSphere.physicsImpostor.setLinearVelocity(vel.scale(.98));
          var forward = camera.getFrontPosition(1).subtract(camera.position);
          forward.y = 0;
          forward = forward.normalize().scale(1);
          
          var backward = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY(Math.PI));
          var left = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY((3 * Math.PI) / 2));
          var  right = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY(Math.PI / 2));
          if (keys.w) {
            if(!startTime) {startTime = Date.now();}
            playerSphere.applyImpulse(forward, playerSphere.getAbsolutePosition());
          }
          if (keys.s) {
            playerSphere.applyImpulse(backward, playerSphere.getAbsolutePosition());
          }
          if (keys.a) {
            playerSphere.applyImpulse(left, playerSphere.getAbsolutePosition());
          }
          if (keys.d) {
            playerSphere.applyImpulse(right, playerSphere.getAbsolutePosition());
          }
          var l = false;
  	      if (playerSphere.position.y < -10 && l == false) {
  	        lost();
  	      }
          if(startTime) {
            timer.innerHTML = ((Date.now() - startTime) / 1000).toFixed(2).replace('.',':');
          }
          });

//NEW CODE
          var currentT = tLookup(xFn, zFn, 500, playerSphere.position.x, playerSphere.position.z);
          var angle = (deriveAngle(currentT, xFn, zFn) - (Math.PI)); 
          camera.alpha += (angle - camera.alpha) / 32; 
          if (currentT > 0.99) {
            win();
          }
//END NEW CODE
      
      function drawPoint(x, z, zrot, scene) {
        var point = BABYLON.MeshBuilder.CreateBox('point', { 
        	width: 10, 
        	height: 0.5, 
        	depth: 12 
        }, scene);
        point.material = new BABYLON.StandardMaterial("pointMaterial", scene);
        point.material.diffuseColor = new BABYLON.Color3(20, 20, 0);
        point.position = new BABYLON.Vector3(x, 0.1, z);
        point.rotation.y = zrot;
        point.physicsImpostor = new BABYLON.PhysicsImpostor(point, BABYLON.PhysicsImpostor.BoxImpostor, {
          mass: 0,
          restitution: 0.9
        }, scene);
      }
      function drawParametric(xFn, zFn, start, end, res, scene) {
        for (var t = start; t <= end; t += ((end - start) / res)) {
          drawPoint(xFn(t), zFn(t), 0, scene);
        }
      }
      drawParametric(xFn, zFn, 0, 1, 350, scene);
      //NEW CODE
      function tLookup(xFn, zFn, res, x, z) {
        var minT = 0;
        var minDist = Infinity;
        for (var t = 0; t <= 1; t += (1 / res)) {
          var dist = Math.pow(x - xFn(t), 2) + Math.pow(z - zFn(t), 2);
          if (dist < minDist) {
            minDist = dist;
            minT = t;
          }
        }
        return minT;
      }
//END NEW CODE
    function deriveAngle(t, xFn, zFn) {
    function derive(f, x) {
    var h = 2.2e-10;
    return (f(x + h) - f(x - h)) / (2 * h);
    }
    return Math.atan2(derive(zFn, t), derive(xFn, t));
    } 
     
      wallAt(xFn, zFn, 0.01, -6.1, scene); 
       wallAt(xFn, zFn, 0.02, -6.1, scene);
       wallAt(xFn, zFn, 0.03, -6.1, scene);
        wallAt(xFn, zFn, 0.04, -6.1, scene);
        wallAt(xFn, zFn, 0.05, -6.1, scene);
         wallAt(xFn, zFn, 0.06, -6.1, scene);
         wallAt(xFn, zFn, 0.07, -6.1, scene);
          wallAt(xFn, zFn, 0.08, -6.1, scene);
          wallAt(xFn, zFn, 0.09, -6.1, scene);
          wallAt(xFn, zFn, 0.14, -6.1, scene);
          wallAt(xFn, zFn, 0.19, -6.1, scene);
           wallAt(xFn, zFn, 0.25, -6.1, scene);
            wallAt(xFn, zFn, 0.32, -6.1, scene);
    function rampAt(xFn, zFn, t, angle, scene) {
      var ramp = BABYLON.MeshBuilder.CreateBox('ramp', {
      height: 10,
      width: .25,
      depth: 12
      }, scene);
      ramp.material = new BABYLON.StandardMaterial("rampMaterial", scene);
      ramp.material.diffuseColor = new BABYLON.Color3(0, 0, 235);
      ramp.physicsImpostor = new BABYLON.PhysicsImpostor(ramp, BABYLON.PhysicsImpostor.BoxImpostor, {
      mass: 0,
      restitution: 0.9
      }, scene);
      ramp.position = new BABYLON.Vector3(xFn(t), 3.2, zFn(t));
      ramp.rotation.z = angle;
      ramp.rotation.y = -deriveAngle(t, xFn, zFn);
    }
     function wallAt(xFn, zFn, t, offset, scene)
      {
      

      var wall = BABYLON.MeshBuilder.CreateBox('wall', {
        height: 30,
        width: .35,
        depth: 12
        }, scene);
        angle = -deriveAngle(t, xFn, zFn); 
        wall.material = new BABYLON.StandardMaterial("wallMaterial", scene);
        wall.material.diffuseColor = new BABYLON.Color3(1, 1, 0);
        wall.physicsImpostor = new BABYLON.PhysicsImpostor(wall, BABYLON.PhysicsImpostor.BoxImpostor, {
          mass: 0,
          restitution: 0.9
          }, scene);
          wall.position = new BABYLON.Vector3(xFn(t) + (offset * Math.sin(angle)), 4, zFn(t) + (offset * Math.cos(angle)));
          wall.rotation.y = angle + (Math.PI / 2);
          return wall;
          }  
 
     engine.runRenderLoop(scene.render.bind(scene));
      
      window.addEventListener('resize', engine.resize.bind(engine));
    }
    function lost(){
      window.location.reload();
      alert("WOW! your sutch a Noob");
    }
//NEW CODE
    function win(){
        window.location.reload();
        alert("WOW! im impressed!");
    }
//END NEW CODE
  </script>
</head>
<body onload="start()">
  <canvas id="renderCanvas"></canvas>

 <div id="timer">00:00</div> 

</body>
</html>